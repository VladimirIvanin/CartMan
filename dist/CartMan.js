/*!
 * CartMan v0.2.5
 * Vladimir Ivanin
 * 2017
 */
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
function deleteItems(e,t){var s=getDataAttrName(system.selectors.item_delete),a=getDataAttrName(system.selectors.item);if(!$(s).length)return!1;var r=t.action.button.parents(a+":first");r.addClass(system.classes.removed),e.hideCartItems&&r.slideUp(300,function(){$(this).remove()})}var getDataAttrName=require("./help").getDataAttrName,system=require("../variables").system;module.exports=deleteItems;
},{"../variables":9,"./help":3}],2:[function(require,module,exports){
function updateDiscounts(t){var e=getDataAttrName(system.selectors.discounts);if(!($(e).length&&t))return!1;$.ajax({url:"/cart_items",dataType:"html"}).done(function(t){var a=$(t).find(e).html();$(e).html(a)})}var getDataAttrName=require("./help").getDataAttrName,system=require("../variables").system;module.exports=updateDiscounts;
},{"../variables":9,"./help":3}],3:[function(require,module,exports){
function getDataAttrName(t,e){return"[data-"+(e?t+'="'+e+'"':t)+"]"}function getTemplate(t,e){return t&&"string"==typeof t||(t=""),$.each(e,function(e,a){t=t.replace(a.reg,a.data)}),t}var declinationText=function(t,e){var a=["товар","товара","товаров"];e&&(a=e);var n=[2,0,1,1,1,2];return a[t%100>4&&t%100<20?2:n[t%10<5?t%10:5]]};module.exports={getDataAttrName:getDataAttrName,getTemplate:getTemplate,declinationText:declinationText};
},{}],4:[function(require,module,exports){
var defaults=require("../variables").defaults,init=require("./init"),CartMan=function(t){var i=this;return i.state={cart_is_init:!1},i.options=$.extend(!0,{},defaults,t),i.init=init,EventBus?i.init():console.warn("Не подключен common.js"),i};module.exports=CartMan;
},{"../variables":9,"./init":5}],5:[function(require,module,exports){
function init(){var e=this,t=e.options;EventBus.subscribe("delete_items:insales:cart",function(e){deleteItems(t,e),t.deleteItems(e)}),EventBus.subscribe("update_items:insales:cart",function(s){updateData(t,s),updateDiscounts(e.state.cart_is_init),updateClasses(s),t.updateItems(s),e.state.cart_is_init=!0})}var updateClasses=require("./updateClasses"),updateDiscounts=require("./discounts"),deleteItems=require("./deleteItems"),updateData=require("./updateData");module.exports=init;
},{"./deleteItems":1,"./discounts":2,"./updateClasses":6,"./updateData":7}],6:[function(require,module,exports){
function updateClasses(e){$.each(system.selectors,function(s,t){var a=$(getDataAttrName(t));0==e.order_lines.length?a.addClass(system.classes.empty):a.removeClass(system.classes.empty)})}var getDataAttrName=require("./help").getDataAttrName,system=require("../variables").system;module.exports=updateClasses;
},{"../variables":9,"./help":3}],7:[function(require,module,exports){
function updateData(t,e){updateCounts(t,e),updateItemTotal(e.order_lines),updateTotalPrice(e.total_price,e.items_price)}function updateCounts(t,e){var a=$(getDataAttrName(system.selectors.items_count)),o=$(getDataAttrName(system.selectors.positions_count)),s=$(getDataAttrName(system.selectors.items_count_words)),r=$(getDataAttrName(system.selectors.positions_count_words)),n=0==e.order_lines.length?t.counterItemsTextEmpty:t.counterItemsText,i=0==e.order_lines.length?t.counterTemplateEmpty:t.counterTemplate,m=getTemplate(n,[{reg:/%c%/g,data:e.items_count},{reg:/%w%/g,data:declinationText(e.items_count,t.declination)}]),l=getTemplate(i,[{reg:/%c%/g,data:e.items_count}]);a.html(l),s.html(m);var c=0==e.order_lines.length?t.counterPositionTextEmpty:t.counterPositionText,p=0==e.order_lines.length?t.positionsTemplateEmpty:t.positionsTemplate,u=getTemplate(c,[{reg:/%c%/g,data:e.positions_count},{reg:/%w%/g,data:declinationText(e.positions_count,t.declination)}]),d=getTemplate(p,[{reg:/%c%/g,data:e.positions_count}]);o.html(d),r.html(u)}function updateTotalPrice(t,e){var a=$(getDataAttrName(system.selectors.total_price)),o=$(getDataAttrName(system.selectors.items_price));a.html(Shop.money.format(t)),o.html(Shop.money.format(e))}function updateItemTotal(t){var e=system.item_class;_.forEach(t,function(t){$('[data-item-id="'+t.variant_id+'"]').each(function(a,o){$(o).find(getDataAttrName(system.selectors.item_total_price)).html(Shop.money.format(t.total_price)),$(o).find(getDataAttrName(system.selectors.item_count)).html(t.quantity),1==t.quantity?($(o).addClass(e.one),$(o).removeClass(e.moreOne).removeClass(e.moreNine)):t.quantity>1&&t.quantity<10?($(o).addClass(e.moreOne),$(o).removeClass(e.one).removeClass(e.moreNine)):($(o).addClass(e.moreNine),$(o).removeClass(e.one).removeClass(e.moreOne))})})}var getDataAttrName=require("./help").getDataAttrName,declinationText=require("./help").declinationText,getTemplate=require("./help").getTemplate,system=require("../variables").system;module.exports=updateData;
},{"../variables":9,"./help":3}],8:[function(require,module,exports){
window.CartMan=require("CartMan");
},{"CartMan":4}],9:[function(require,module,exports){
var defaults={declination:["товар","товара","товаров"],hideCartItems:!0,counterTemplate:"(%c%)",counterTemplateEmpty:null,positionsTemplate:"(%c%)",positionsTemplateEmpty:null,counterItemsText:"В вашей корзине %c%&nbsp;%w%",counterItemsTextEmpty:"В вашей корзине %c%&nbsp;%w%",counterPositionText:"В вашей корзине %c%&nbsp;%w%",counterPositionTextEmpty:"В вашей корзине %c%&nbsp;%w%",updateItems:function(){},deleteItems:function(){}},system={selectors:{quantity:"quantity",item:"item-id",item_delete:"item-delete",item_total_price:"item-total-price",item_count:"item-count",items_price:"items-price",total_price:"total-price",items_count:"items-count",positions_count:"positions-count",items_count_words:"items-text",positions_count_words:"positions-text",discounts:"discounts"},classes:{init:"is-cart-init",removed:"is-removed",empty:"is-cart-empty"},item_class:{one:"is-one",moreOne:"more-than-one",moreNine:"more-than-nine"}};module.exports={defaults:defaults,system:system};
},{}]},{},[8]);
